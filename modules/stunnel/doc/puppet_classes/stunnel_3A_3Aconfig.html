<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: stunnel::config
  
    &mdash; Documentation by YARD 0.9.9
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_classes::stunnel::config";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (s)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">stunnel::config</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: stunnel::config</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd><span class='object_link'><a href="stunnel.html" title="puppet_classes::stunnel (puppet_class)">stunnel</a></span></dd>
  </dl>
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/config.pp
    </dd>
  </dl>
</div>

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>Global stunnel options</p>

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>chroot</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;/var/stunnel&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The location of the chroot jail</p>
<ul><li>
<p>Do <strong>NOT</strong> make this anything under <code>/var/run</code></p>
</li></ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pki</span>
      
      
        <span class='type'>(<tt>Variant[Enum['simp'],Boolean]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::stunnel::pki</tt>)</em>
      
      
        &mdash;
        <div class='inline'><ul><li>
<p>If <code>simp</code>, include SIMP&#39;s <code>pki</code> module and use
<code>pki::copy</code> to  manage application certs in
<code>/etc/pki/simp_apps/stunnel/x509</code></p>
</li><li>
<p>If <code>true</code>, do <em>not</em> include SIMP&#39;s pki module, but
still use  <code>pki::copy</code> to manage certs in
<code>/etc/pki/simp_apps/stunnel/x509</code></p>
</li><li>
<p>If <code>false</code>, do not include SIMP&#39;s pki module and do not use 
<code>pki::copy</code> to manage certs. You will need to appropriately
assign a  subset of:</p>
<ul><li>
<p>app_pki_dir</p>
</li><li>
<p>app_pki_key</p>
</li><li>
<p>app_pki_cert</p>
</li><li>
<p>app_pki_ca_dir</p>
</li></ul>
</li></ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>app_pki_external_source</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::stunnel::app_pki_external_source</tt>)</em>
      
      
        &mdash;
        <div class='inline'><ul><li>
<p>If pki = <code>simp</code> or <code>true</code>, this is the directory from
which certs  will be copied, via <code>pki::copy</code></p>
</li><li>
<p>If pki = <code>false</code>, this variable has no effect</p>
</li></ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>app_pki_dir</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::stunnel::app_pki_dir</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The source of certs in the chroot, and the basepath of
<code>$app_pki_key</code>, <code>$app_pki_cert</code>,
<code>$app_pki_ca</code>, <code>$app_pki_ca_dir</code>, and
<code>$app_pki_crl</code></p>
<ul><li>
<p><strong>NOTE:</strong> Even when using a chroot, stunnel needs the certs to
reside  <strong>outside</strong> of the chroot path</p>
</li></ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>app_pki_key</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::stunnel::app_pki_key</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Path and name of the private SSL key file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>app_pki_cert</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::stunnel::app_pki_cert</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Path and name of the public SSL certificate</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>app_pki_ca_dir</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::stunnel::app_pki_ca_dir</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Since stunnel runs in a chroot, you need to copy the appropriate CA
certificates in from an external source</p>
<ul><li>
<p>This should be the full path to a directory containing
<strong>hashed</strong> versions of the CA certificates</p>
</li></ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>app_pki_crl</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::stunnel::app_pki_crl</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Since stunnel runs in a chroot, you need to copy the appropriate CRL in
from an external source</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pid</span>
      
      
        <span class='type'>(<tt>Stdlib::Absolutepath</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;/var/run/stunnel/stunnel.pid&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The PID file</p>
<ul><li>
<p>Relative to the chroot jail!</p>
</li><li>
<p>Let the startup script handle it by default</p>
</li></ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>setuid</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::stunnel::setuid</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The user stunnel should run as</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>setgid</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::stunnel::setgid</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The group stunnel should run as</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>stunnel_debug</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;err&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The debug level for logging</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>syslog</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::stunnel::syslog</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Enable logging to syslog</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>compression</span>
      
      
        <span class='type'>(<tt>Optional[Enum['zlib','rle']]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The compression type to use for this service</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>egd</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The path to the Entropy Gathering Daemon socket used to feed the OpenSSL
Random Number Generator</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>engine</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;auto&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>If <code>$egd</code> is set, sets the Hardware Engine to be used</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>engine_ctrl</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>If <code>$egd</code> is set, sets the Hardware Engine Control parameters</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>fips</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>$::stunnel::fips</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Set the <code>fips</code> global option</p>
<ul><li>
<p>We don&#39;t enable FIPS mode by default since we want to be able to use 
TLS1.2</p>
</li><li>
<p><strong>NOTE:</strong> This has no effect on EL &lt; 7 due to stunnel not
accepting the  fips option in that version of stunnel</p>
</li></ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>output</span>
      
      
        <span class='type'>(<tt>Optional[Stdlib::Absolutepath]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The path to a log output file to use</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rnd_bytes</span>
      
      
        <span class='type'>(<tt>Optional[Integer]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The number of bytes to read from the random seed file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rnd_file</span>
      
      
        <span class='type'>(<tt>Optional[Stdlib::Absolutepath]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The path to the random seed data file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rnd_overwrite</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Overwrite the random seed file with new random data</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>socket_options</span>
      
      
        <span class='type'>(<tt>Array[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[]</tt>)</em>
      
      
    </li>
  
</ul>

<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>Trevor Vaughan <a
href="mailto:tvaughan@onyxpoint.com">tvaughan@onyxpoint.com</a></p>
</div>
      
    </li>
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>Nick Markowski <a
href="mailto:nmarkowski@keywcorp.com">nmarkowski@keywcorp.com</a></p>
</div>
      
    </li>
  
</ul>

</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/config.pp', line 109</span>

class stunnel::config (
  Variant[Enum[&#39;simp&#39;],Boolean]  $pki                     = $::stunnel::pki,
  Stdlib::Absolutepath           $app_pki_dir             = $::stunnel::app_pki_dir,
  Stdlib::Absolutepath           $app_pki_external_source = $::stunnel::app_pki_external_source,
  Stdlib::Absolutepath           $app_pki_key             = $::stunnel::app_pki_key,
  Stdlib::Absolutepath           $app_pki_cert            = $::stunnel::app_pki_cert,
  Stdlib::Absolutepath           $app_pki_ca_dir          = $::stunnel::app_pki_ca_dir,
  Stdlib::Absolutepath           $app_pki_crl             = $::stunnel::app_pki_crl,
  Stdlib::Absolutepath           $chroot                  = &#39;/var/stunnel&#39;,
  Stdlib::Absolutepath           $pid                     = &#39;/var/run/stunnel/stunnel.pid&#39;,
  String                         $setuid                  = $::stunnel::setuid,
  String                         $setgid                  = $::stunnel::setgid,
  String                         $stunnel_debug           = &#39;err&#39;,
  Optional[Enum[&#39;zlib&#39;,&#39;rle&#39;]]   $compression             = undef,
  Optional[String]               $egd                     = undef,
  String                         $engine                  = &#39;auto&#39;,
  Optional[String]               $engine_ctrl             = undef,
  Optional[Stdlib::Absolutepath] $output                  = undef,
  Optional[Integer]              $rnd_bytes               = undef,
  Optional[Stdlib::Absolutepath] $rnd_file                = undef,
  Boolean                        $rnd_overwrite           = false,
  Array[String]                  $socket_options          = [],
  Boolean                        $syslog                  = $::stunnel::syslog,
  Boolean                        $fips                    = $::stunnel::fips
) inherits stunnel {

  if $facts[&#39;selinux_current_mode&#39;] and $facts[&#39;selinux_current_mode&#39;] != &#39;disabled&#39; {
    $_chroot = undef
  }
  else {
    $_chroot = $chroot
  }

  if $pki {
    pki::copy { &#39;stunnel&#39;:
      source =&gt; $app_pki_external_source,
      pki    =&gt; $pki
    }
  }

  concat { &#39;/etc/stunnel/stunnel.conf&#39;:
    owner          =&gt; &#39;root&#39;,
    group          =&gt; &#39;root&#39;,
    mode           =&gt; &#39;0600&#39;,
    ensure_newline =&gt; true,
    warn           =&gt; true
  }

  concat::fragment { &#39;0_stunnel_global&#39;:
    order   =&gt; 1,
    target  =&gt; &#39;/etc/stunnel/stunnel.conf&#39;,
    content =&gt; template(&#39;stunnel/stunnel.erb&#39;)
  }

  if $_chroot {
    # The _chroot directory
    file { $_chroot:
      ensure =&gt; &#39;directory&#39;,
      owner  =&gt; &#39;root&#39;,
      group  =&gt; $setgid,
      mode   =&gt; &#39;0770&#39;
    }

    # The following two entries are required to be able to properly resolve
    # hosts using the _chroot directory.
    file { &quot;${_chroot}/etc&quot;:
      ensure =&gt; &#39;directory&#39;,
      owner  =&gt; &#39;root&#39;,
      group  =&gt; &#39;root&#39;,
      mode   =&gt; &#39;0755&#39;
    }

    file { &quot;${_chroot}/etc/resolv.conf&quot;:
      ensure =&gt; &#39;file&#39;,
      owner  =&gt; &#39;root&#39;,
      group  =&gt; &#39;root&#39;,
      mode   =&gt; &#39;0644&#39;,
      source =&gt; &#39;file:///etc/resolv.conf&#39;
    }

    file { &quot;${_chroot}/etc/nsswitch.conf&quot;:
      ensure =&gt; &#39;file&#39;,
      owner  =&gt; &#39;root&#39;,
      group  =&gt; &#39;root&#39;,
      mode   =&gt; &#39;0644&#39;,
      source =&gt; &#39;file:///etc/nsswitch.conf&#39;
    }

    file { &quot;${_chroot}/etc/hosts&quot;:
      ensure =&gt; &#39;file&#39;,
      owner  =&gt; &#39;root&#39;,
      group  =&gt; &#39;root&#39;,
      mode   =&gt; &#39;0644&#39;,
      source =&gt; &#39;file:///etc/hosts&#39;
    }

    file { &quot;${_chroot}/var&quot;:
      ensure =&gt; &#39;directory&#39;,
      owner  =&gt; &#39;root&#39;,
      group  =&gt; &#39;root&#39;,
      mode   =&gt; &#39;0644&#39;
    }

    file { &quot;${_chroot}/var/run&quot;:
      ensure =&gt; &#39;directory&#39;,
      owner  =&gt; $setuid,
      group  =&gt; $setgid,
      mode   =&gt; &#39;0644&#39;
    }

    file { &quot;${_chroot}/var/run/stunnel&quot;:
      ensure =&gt; &#39;directory&#39;,
      owner  =&gt; $setuid,
      group  =&gt; $setgid,
      mode   =&gt; &#39;0644&#39;
    }

    file { &quot;${_chroot}/etc/pki&quot;:
      ensure =&gt; &#39;directory&#39;,
      owner  =&gt; &#39;root&#39;,
      group  =&gt; $setgid,
      mode   =&gt; &#39;0640&#39;
    }

    file { &quot;${_chroot}/etc/pki/cacerts&quot;:
      source  =&gt; &quot;file://${app_pki_dir}/cacerts&quot;,
      group   =&gt; $setgid,
      mode    =&gt; &#39;0640&#39;,
      recurse =&gt; true,
    }
  }

}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
  Generated on Thu Jun 22 21:06:45 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.9 (ruby-2.1.9).
</div>

    </div>
  </body>
</html>